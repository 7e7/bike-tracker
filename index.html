<!DOCTYPE html>
<html>
<head>
<title>Bike Tracker</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.0/backbone-min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" />
<style>
.stage{padding:40px 15px;}
</style>
</head>
<!-- 
some high level to dos

add in new locations to the store view
add in bike location tracking into the storage locations model/view and BikeView view
add in data persistence via storage api
replace the App.init event handlers with a NavView view

 -->
<body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#home">Bike Tracker</a>
            </div>
            <div class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                <li class="active"><a href="#home">Home</a></li>
                <li><a href="#bikes">Bikes</a></li>
                <li><a href="#locations">Locations</a></li>
              </ul>
            </div>
        </div>
    </div>
    <div class="container stage">
        <div class="view-group jumbotron" id="home">
            <div class="welcome">
                <h1>Hello</h1>
                <p>So this is just a sandbox backbone project.</p>
                <p>In theory, you can track where your bikes are with this.  Thats still a bit off into the future.</p>
                <p>This project's github is <a target="_blank" href="https://github.com/7e7/bike-tracker">here</a>.</p>
            </div>
        </div>
        <div class="view-group row" id="bikes">
            <div class="bikes col-md-3"></div>
            <div class="bike col-md-9"></div>
        </div>
        <div class="view-group" id="locations">
            <div class="store bikes col-md-3"></div>
            <div class="location bikes col-md-9"></div>
        </div>        
    </div>
<script>
var Bike = Backbone.Model.extend({}),
    Bikes = Backbone.Collection.extend({ model:Bike }),
    StorageLocation = Backbone.Model.extend({
        addBike:function(id){
            if (id && _.indexOf(this.attributes.bikes, id) < 0){
                this.attributes.bikes.push(id)
                return true;
            }
            else{
                return false;
            }
        },
        removeBike:function(){
            
        }
    }),
    Store = Backbone.Collection.extend({ model: StorageLocation })
    BikeListView = Backbone.View.extend({
        initialize: function(){
            this.render();
        },
        template: _.template(["<h1>Bikes</h1><ul class='bike_list'>",
                "<% items.each(function(item) { %>",
                    "<%= itemTemplate(item) %>",
                "<% }); %>",
            "</ul><button class='add'>Add a bike</button>"
            ].join('')),
        itemTemplate:_.template("<li><a href='#<%= cid %>'><%= attributes.name %></a></li>"),
        newItemTemplate:_.template(["<li><form>",
            "<input type='text' class='name' name='name' placeholder='name'/>",
            "<input type='text' class='make' name='make' placeholder='make'/>",
            "<input type='text' class='model' name='model' placeholder='model'/>",
            "<input type='number' class='year' name='year' placeholder='2014' min='1950'/><br/>",
            "<input type='submit' value='add' />",
            "<button class='cancel'>cancel</button>",
        "</form></li>"].join('')),
        render: function() {
            $(this.el).empty().append(this.template({
              items: App.bikes,
              itemTemplate: this.itemTemplate
            }));
        },
        el: $('.bikes'),
        events:{
            "click .bike_list a":"showBike",
            "click button.add": 'newBikeLine',
            "click button.cancel":'removeBikeLine',
            "submit form": 'addNewBike'
        },
        showBike:function(ev){
            ev.preventDefault();
            bv.render(ev.target.hash.substring(1));
        },
        newBikeLine: function(){
            $(this.el).find('.bike_list').append(this.newItemTemplate())
        },
        removeBikeLine: function(event){
            event.preventDefault();
            $(event.target).parents('li').remove()
        },
        addNewBike:function(){
            event.preventDefault();
            $(event.target).parents('li').after(this.itemTemplate(App.bikes.add({
                name:event.target.name.value,
                make:event.target.make.value,
                model:event.target.model.value,
                year:event.target.year.value,
                location:""
            }))).remove()
        },
    }),
    BikeView = Backbone.View.extend({
        initialize:function(){},
        render:function(id){ $(this.el).empty().append( this.template({ bike: App.bikes.get(id) })) },
        template: _.template(['<h1><%= bike.attributes.name %></h1><dl>',
            '<dt>Make</dt><dd><%= bike.attributes.make %></dd>',
            '<dt>Model</dt><dd><%= bike.attributes.model %></dd>',
            '<dt>Year</dt><dd><%= bike.attributes.year %></dd>',
            '<dt>Location</dt><dd><% if(bike.attributes.location){ %><%= bike.attributes.location %> <button>Move bike</button> <% } else { %>None  <button>Set Location</button><% } %> </dd>',
        '</dl>'].join('')),
        el:$('.bike')
    
    })
    StoreView = Backbone.View.extend({
        initialize:function(){
             this.render();
        },
        render:function(){
            $(this.el).empty().append(this.template({
              items: App.store,
              itemTemplate: this.itemTemplate
            }));
        },
        el:$('.store'),
        template: _.template(["<h1>Storage Locations</h1><ul class='location_list'>",
                "<% items.each(function(item) { %>",
                    "<%= itemTemplate(item) %>",
                "<% }); %>",
            "</ul><button>Add a location</button>"
            ].join('')),
        itemTemplate:_.template("<li><a href='#<%= cid %>'><%= attributes.name %></a></li>"),
        newItemTemplate:_.template('<li><form><input type="text" name="name" placeholder="name"/><input type="submit" value="add"><button class="cancel">cancel</button></form></li>'),
        events:{
            "click a":"showStorageLocation"
        },
        showStorageLocation:function(event){
            event.preventDefault();
            console.log(event)
            slv.render(event.target.hash.substring(1));
        }
    }),
    StorageLocationView = Backbone.View.extend({
        initialize:function(){},
        render:function(id){
            $(this.el).empty().append(this.template({location: App.store.get(id), itemTemplate:this.itemTemplate}))
        },
        el:$('.location'),
        template: _.template(['<h1><%= location.attributes.name %></h1>',
            "<ul>",
                "",
                "<li></li>",
        "</ul>"].join('')),
        itemTemplate:"<li><%= item %></li>"
    }),
    NavView = Backbone.View.extend({
        initialize:function(){},
        render:function(){},
        template:_.template(''),
        el:$()
    });
App={
    bikes: new Bikes([
        {"name":"The Dale", "make":"Cannondale", "model": "CAAD10 Ultegra", "year":2014, "location": ""},
        {"name":"Rocket Ship", "make":"Trek", "model": "1.5", "year":2011, "location": ""},
        {"name":"Batmobile", "make":"Trek", "model": "7.2", "year":2012, "location": ""},
        {"name":"Cross", "make":"Focus", "model": "Mares AX 3.0", "year":2013, "location": ""}
    ]),
    store: new Store([
        {name: "Floor1", bikes:['test1'] },
        {name: "Basement", bikes:['2','3'] }
    ]),
    init:function(){
        blv = new BikeListView(), 
        bv = new BikeView(),
        sv = new StoreView(),
        slv = new StorageLocationView();
        
        $('.view-group').hide().filter('#home').show();
        $('.navbar a').on('click', function(event){ 
            event.preventDefault();
            $('.view-group').hide().filter(event.target.hash).show();
            $('.navbar li').removeClass('active').filter($(this).parents('li')).addClass('active');
            if($(this).hasClass('navbar-brand')){ $('a[href=#home]').parents('li').addClass('active') }
            //add in view rerenders, for funsies?
        })
    }
};

App.init();
App.scaffold=function(){
    
}

</script>



</body>
</html>